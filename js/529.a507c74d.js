"use strict";(self["webpackChunkcrm_course"]=self["webpackChunkcrm_course"]||[]).push([[529],{3529:function(e,t,a){a.r(t),a.d(t,{default:function(){return D}});var o=a(3396),s=a(9242),i=a(7139);const r={class:"record"},n=(0,o._)("div",{class:"page-title"},[(0,o._)("h3",null,"Новая запись")],-1),l={class:"form_header"},c={class:"radio"},u=(0,o._)("strong",null,"Тип записи:",-1),d={class:"radio_input"},m=(0,o._)("label",{for:"income"},"Доход",-1),p={class:"radio_input"},h=(0,o._)("label",{for:"outcome"},"Расход",-1),y={key:0,class:"select"},g={key:1},_=(0,o._)("i",{class:"fa-solid fa-check"},null,-1),f={key:1,class:"handle_category"},v={key:1,class:"handler"};function w(e,t,a,w,k,$){const b=(0,o.up)("base-select"),U=(0,o.up)("router-link"),V=(0,o.up)("base-input"),C=(0,o.up)("base-button"),D=(0,o.up)("base-loader");return(0,o.wg)(),(0,o.iD)("div",r,[n,k.loading?((0,o.wg)(),(0,o.iD)("div",v,[(0,o.Wm)(D)])):((0,o.wg)(),(0,o.iD)("form",{key:0,class:"record_form",onSubmit:t[5]||(t[5]=(0,s.iM)(((...e)=>$.handleForm&&$.handleForm(...e)),["prevent"]))},[(0,o._)("div",l,[(0,o._)("div",c,[u,(0,o._)("div",d,[m,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>k.type=e),name:"type",type:"radio",value:"income",id:"income"},null,512),[[s.G2,k.type]])]),(0,o._)("div",p,[h,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>k.type=e),name:"type",type:"radio",value:"outcome",id:"outcome"},null,512),[[s.G2,k.type]])])]),k.categories.length?((0,o.wg)(),(0,o.iD)("div",y,[(0,o.Wm)(b,{modelValue:k.category,"onUpdate:modelValue":t[2]||(t[2]=e=>k.category=e),options:k.categories},{default:(0,o.w5)((()=>[(0,o.Uk)("Выберите категорию")])),_:1},8,["modelValue","options"])])):((0,o.wg)(),(0,o.iD)("p",g,[(0,o.Uk)("Категорий пока нет. "),(0,o.Wm)(U,{to:"/categories"},{default:(0,o.w5)((()=>[(0,o.Uk)("Создать")])),_:1})]))]),(0,o.Wm)(V,{modelValue:k.amount,"onUpdate:modelValue":t[3]||(t[3]=e=>k.amount=e),modelModifiers:{number:!0},placehldr:"Введите сумму",class:(0,i.C_)({incorrect:k.v$.amount.$errors.length})},{default:(0,o.w5)((()=>[(0,o.Uk)(" Сумма ")])),_:1},8,["modelValue","class"]),(0,o.Wm)(V,{modelValue:k.description,"onUpdate:modelValue":t[4]||(t[4]=e=>k.description=e),placehldr:"Введите описание",class:(0,i.C_)({incorrect:k.v$.description.$errors.length})},{default:(0,o.w5)((()=>[(0,o.Uk)("Описание")])),_:1},8,["modelValue","class"]),k.category?((0,o.wg)(),(0,o.j4)(C,{key:0},{default:(0,o.w5)((()=>[(0,o.Uk)("Создать "),_])),_:1})):((0,o.wg)(),(0,o.iD)("p",f,"Выберите категорию операции выше"))],32))])}a(7658);var k=a(1508),$=a(3053),b=a(9117),U={components:{BaseButton:k.Z},name:"RecordPage",data(){return{v$:(0,$.ZP)(),amount:1,description:"",category:"",loading:!0,categories:[],type:"income"}},validations(){return{amount:{required:b.C1,minValue:(0,b.uv)(.01)},description:{required:b.C1},category:{required:b.C1},type:{required:b.C1}}},async mounted(){const e=await this.$store.dispatch("fetchCategories");e.forEach((e=>{this.categories.push({name:e.title,value:e.id})})),this.loading=!1},computed:{canCreateRecord(){const e=this.$store.state.auth.userInfo.bill;return"outcome"!==this.type||e>=this.amount}},methods:{async handleForm(){this.v$.$validate(),this.v$.$errors.length||(this.canCreateRecord?this.pushRecord():alert("Для совершения операции на вашем счету недостаточно средств - "+(this.amount-this.$store.state.auth.userInfo.bill)))},async pushRecord(){const e={description:this.description,amount:this.amount,date:(new Date).toJSON(),category:this.category,type:this.type},t="income"===e.type?this.$store.state.auth.userInfo.bill+=e.amount:this.$store.state.auth.userInfo.bill-=e.amount;await this.$store.dispatch("pushRecord",e),await this.$store.dispatch("setUserBill",t),this.description="",this.amount=1,this.v$.$reset()}}},V=a(89);const C=(0,V.Z)(U,[["render",w]]);var D=C}}]);
//# sourceMappingURL=529.a507c74d.js.map